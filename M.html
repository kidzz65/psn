<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Photo Booth</title>

<style>
html, body{
    margin:0;
    padding:0;
    height:100%;
    overflow:hidden;
    font-family:'Segoe UI', sans-serif;
    background:#f4f4f4;
    color:#333;
}

.container{
    padding:0 5%;
    height:100%;
    box-sizing:border-box;
}

.header{
    text-align:center;
    padding-top:15px;
    font-size:20px;
    font-weight:600;
    letter-spacing:1px;
}

/* START */
#startScreen{
    height:calc(100% - 50px);
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
    text-align:center;
}

button{
    padding:10px 25px;
    border:none;
    border-radius:25px;
    background:#111;
    color:white;
    cursor:pointer;
    margin:5px;
}

/* CAMERA */
#cameraScreen{ display:none; }

.camera-box{
    position:relative;
    width:100%;
    aspect-ratio:4/3; /* RASIO 4:3 */
    margin-top:15px;
}

video{
    width:100%;
    height:100%;
    object-fit:cover;
    border-radius:20px;
    box-shadow:0 10px 25px rgba(0,0,0,0.1);
}

/* TIMER */
#timer{
    position:absolute;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%);
    font-size:70px;
    font-weight:bold;
    color:white;
    text-shadow:0 0 20px rgba(0,0,0,0.7);
}

/* BOTTOM */
.bottom-section{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-top:8px;
}

.preview{
    display:flex;
    gap:6px;
}
.preview img{
    width:60px;
    height:80px;
    object-fit:cover;
    border-radius:8px;
}

/* EDIT */
#editScreen{
    display:none;
    text-align:center;
    margin-top:15px;
}

.option-group{
    margin:10px 0;
}

#finalPreview img{
    width:100%;
    max-width:350px;
    margin-top:15px;
    border-radius:15px;
}
</style>
</head>
<body>

<div class="container">

<div class="header">Photo Booth</div>

<!-- START -->
<div id="startScreen">
    <h3>Akan mengambil 3 foto</h3>
    <p>Setiap foto memiliki timer 3 detik</p>
    <button onclick="startBooth()">Mulai</button>
</div>

<!-- CAMERA -->
<div id="cameraScreen">
    <div class="camera-box">
        <video id="video" autoplay></video>
        <div id="timer"></div>
    </div>

    <div class="bottom-section">
        <div class="preview" id="photoPreview"></div>
        <div>
            <button onclick="takePhoto()">Foto</button>
            <button onclick="resetPhotos()">Ulang</button>
        </div>
    </div>
</div>

<!-- EDIT -->
<div id="editScreen">
    <h3>Pilih Layout</h3>
    <div class="option-group">
        <button onclick="setLayout('vertical')">Vertical</button>
        <button onclick="setLayout('horizontal')">Horizontal</button>
    </div>

    <h3>Pilih Frame</h3>
    <div class="option-group">
        <button onclick="setFrame('#111')">Black</button>
        <button onclick="setFrame('#c62828')">Red</button>
        <button onclick="setFrame('#d4af37')">Gold</button>
    </div>

    <button onclick="generatePreview()">Tampilkan</button>

    <div id="finalPreview"></div>
</div>

</div>

<canvas id="canvas" style="display:none;"></canvas>

<script>
let video=document.getElementById("video");
let photos=[];
let selectedLayout="vertical";
let selectedFrame="#111";

function startBooth(){
    document.getElementById("startScreen").style.display="none";
    document.getElementById("cameraScreen").style.display="block";

    navigator.mediaDevices.getUserMedia({
        video:{ aspectRatio:4/3 }
    })
    .then(stream=> video.srcObject=stream)
    .catch(()=> alert("Kamera tidak bisa diakses"));
}

function startTimer(callback){
    let timer=document.getElementById("timer");
    let count=3;
    timer.innerText=count;

    let interval=setInterval(()=>{
        count--;
        timer.innerText=count;
        if(count<=0){
            clearInterval(interval);
            timer.innerText="";
            callback();
        }
    },1000);
}

function takePhoto(){
    if(photos.length>=3) return;

    startTimer(()=>{
        let canvas=document.getElementById("canvas");
        canvas.width=video.videoWidth;
        canvas.height=video.videoHeight;
        canvas.getContext("2d").drawImage(video,0,0);
        photos.push(canvas.toDataURL("image/png"));
        updatePreview();

        if(photos.length===3){
            document.getElementById("cameraScreen").style.display="none";
            document.getElementById("editScreen").style.display="block";
        }
    });
}

function updatePreview(){
    let preview=document.getElementById("photoPreview");
    preview.innerHTML="";
    photos.forEach(p=>{
        preview.innerHTML+=`<img src="${p}">`;
    });
}

function resetPhotos(){
    photos=[];
    updatePreview();
}

function setLayout(layout){ selectedLayout=layout; }
function setFrame(frame){ selectedFrame=frame; }

function generatePreview(){
    let finalCanvas=document.createElement("canvas");
    let ctx=finalCanvas.getContext("2d");

    let width=350,height=900;
    if(selectedLayout==="horizontal"){width=900;height=350;}

    finalCanvas.width=width;
    finalCanvas.height=height;

    ctx.fillStyle=selectedFrame;
    ctx.fillRect(0,0,width,height);

    let loaded=0;

    photos.forEach((p,i)=>{
        let img=new Image();
        img.src=p;
        img.onload=function(){
            if(selectedLayout==="vertical"){
                ctx.drawImage(img,25,25+(i*280),300,250);
            }else{
                ctx.drawImage(img,25+(i*300),50,250,250);
            }

            loaded++;
            if(loaded===3){
                let finalImg=finalCanvas.toDataURL("image/png");
                document.getElementById("finalPreview").innerHTML=`
                    <img src="${finalImg}">
                    <br>
                    <a href="${finalImg}" download="photobooth.png">
                        <button style="margin-top:10px;">Unduh</button>
                    </a>
                `;
            }
        }
    });
}
</script>

</body>
</html>